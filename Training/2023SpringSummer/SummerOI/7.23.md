# [NOI2002] 银河英雄传说

## 题目背景

公元 $5801$ 年，地球居民迁至金牛座 $\alpha$ 第二行星，在那里发表银河联邦创立宣言，同年改元为宇宙历元年，并开始向银河系深处拓展。

宇宙历 $799$ 年，银河系的两大军事集团在巴米利恩星域爆发战争。泰山压顶集团派宇宙舰队司令莱因哈特率领十万余艘战舰出征，气吞山河集团点名将杨威利组织麾下战舰迎敌。

## 题目描述

莱因哈特老谋深算，擅长排兵布阵。他手下有 $n$ 艘战舰，一开始每艘战舰都是独立的。接下来，莱因哈特发出了一系列命令，形如 `1 u v` 和 `2 u v`，其中 `1 u v` 表示在 `u` 和 `v` 间建立联系构成**一棵树**，`2 u v` 则表示断开 `u` 和 `v` 的联系。显然，在两艘战舰间最多存在一条路径。每艘战舰都有一个初始的战斗力 `val[i]` 。莱因哈特意气风发，认为一定能全歼杨威利的舰队。

然而他不知道的是，杨威利的特务早已潜入敌营，刺探到了莱因哈特的所有情报。杨威利会发出形如 `3 u v` 和 `4 u v` 的指令，其中 `3 u v` 表示查询从 `u` 到 `v` 的路径上的所有战舰战斗力之和，而 `4 u v` 表示对 `u` 到 `v` 路径上的战舰发起袭击，使每艘战舰的战斗力变成 $\lfloor\ln(val_i)+1\rfloor$ 。

但是，杨威利同样也不知道，莱因哈特早就得知了特务的行踪，并且派出了自己的人伪装成特务发回假的情报。因此，**所有操作均不保证合法**。具体而言，`1` 操作不保证 `u, v`不在一棵树上，`2` 操作不保证两者建立了联系，`3 4` 操作不保证两者在同一棵树上。对于这些情况，你应该无视这些指令。特别地，如果 `3` 不合法，你应该输出 `-1`。

现在，杨威利把所有的情报交给了你，请你回答他的每一次询问。

## 输入格式

第一行两个正整数 `n`, `q`，分别表示战舰的数量和询问的次数

第二行 `n` 个正整数，第 `i` 个表示 `val[i]`

接下来 `q` 行，每行一个指令：

- `1 u v` 连接战舰
- `2 u v` 断开战舰间的连接
- `3 u v` 查询战舰之间的战斗力之和
- `4 u v` 向 `u v` 及其路径上的战舰发动袭击！

## 输出格式

对于所有 `3` 操作，一行一个整数表示答案。

## 样例

```
5 14
114 514 19 19 810
3 2 2
1 1 2
3 1 2
2 1 2
3 1 2
1 1 2
1 2 3
4 1 3
3 1 3
1 2 4
3 1 4
1 4 5
4 2 5
3 1 5
```

```
514
628
-1
15
31
17
```

## 数据范围

对于 $10\%$ 的数据：$1 \leq n \leq 5000$

对于另外 $20\%$ 的数据: 保证所有 `1` `2` 操作在 `3` `4` 之前，且为一条链

对于另外 $30\%$ 的数据： 保证所有 `1` `2` 操作在 `3` `4` 之前

对于 $100\%$ 的数据：$1\leq n,q\leq 1\times10^5, 1\leq val_i \leq 10^9$
